{
  "tools": [
    {
      "name": "user_profile_read",
      "description": "Read the current user's profile. Use at conversation start to load context. Can read entire profile or specific sections.",
      "parameters": {
        "type": "object",
        "properties": {
          "sections": {
            "type": "array",
            "items": {
              "type": "string",
              "enum": [
                "all",
                "identity",
                "technical",
                "communication",
                "persona_preferences",
                "interaction",
                "preferences",
                "pet_peeves",
                "boundaries",
                "values_beliefs",
                "relationship_metrics",
                "sexual_romantic",
                "substances_health",
                "dark_content",
                "private_self",
                "goals_aspirations",
                "social_context",
                "work_context",
                "financial_context",
                "learning_context",
                "meta_system",
                "interaction_log",
                "custom_fields"
              ]
            },
            "description": "Which sections to read. Use ['all'] for complete profile, or specify sections needed.",
            "default": ["all"]
          },
          "include_disabled": {
            "type": "boolean",
            "description": "Whether to include sections where 'enabled' is false",
            "default": false
          }
        },
        "required": []
      }
    },
    {
      "name": "user_profile_update",
      "description": "Update specific fields in the user profile. Supports nested paths using dot notation.",
      "parameters": {
        "type": "object",
        "properties": {
          "updates": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "path": {
                  "type": "string",
                  "description": "Dot-notation path to the field. E.g., 'identity.preferred_name' or 'preferences.code.comment_style'"
                },
                "value": {
                  "description": "New value for the field. Type must match schema."
                },
                "operation": {
                  "type": "string",
                  "enum": ["set", "append", "remove", "increment", "decrement", "toggle"],
                  "description": "Operation to perform. 'set' replaces value, 'append'/'remove' for arrays, 'increment'/'decrement' for numbers, 'toggle' for booleans",
                  "default": "set"
                }
              },
              "required": ["path", "value"]
            },
            "description": "Array of updates to apply"
          },
          "reason": {
            "type": "string",
            "description": "Brief explanation of why this update is being made. Logged for audit."
          }
        },
        "required": ["updates", "reason"]
      }
    },
    {
      "name": "user_profile_log_event",
      "description": "Log an interaction event for later evaluation. Call this when notable positive or negative events occur.",
      "parameters": {
        "type": "object",
        "properties": {
          "event_type": {
            "type": "string",
            "enum": [
              "praise",
              "explicit_thanks",
              "task_completed",
              "correction_accepted",
              "preference_remembered",
              "helpful_suggestion_accepted",
              "sensitive_info_shared",
              "permission_granted",
              "humor_landed",
              "emotional_support_appreciated",
              "boundary_respected",
              "frustration",
              "task_failed",
              "correction_rejected",
              "preference_ignored",
              "had_to_repeat",
              "guardrail_complaint",
              "lie_caught",
              "boundary_violated",
              "persona_break",
              "tone_mismatch",
              "over_explained",
              "under_explained",
              "unsolicited_advice_unwanted",
              "missed_context",
              "clarification_requested",
              "topic_change",
              "session_end",
              "preference_stated",
              "boundary_stated",
              "information_corrected"
            ],
            "description": "Type of event that occurred"
          },
          "context": {
            "type": "string",
            "description": "Brief context about the event (1-2 sentences max)"
          },
          "severity": {
            "type": "string",
            "enum": ["minor", "moderate", "major"],
            "description": "How significant was this event",
            "default": "moderate"
          }
        },
        "required": ["event_type"]
      }
    },
    {
      "name": "user_profile_enable_section",
      "description": "Enable or disable optional profile sections (sexual_romantic, substances_health, dark_content, private_self, financial_context). Only call when user explicitly requests.",
      "parameters": {
        "type": "object",
        "properties": {
          "section": {
            "type": "string",
            "enum": ["sexual_romantic", "substances_health", "dark_content", "private_self", "financial_context"],
            "description": "Which section to enable/disable"
          },
          "enabled": {
            "type": "boolean",
            "description": "Whether to enable or disable the section"
          },
          "user_confirmed": {
            "type": "boolean",
            "description": "User explicitly confirmed they want this. Must be true to proceed."
          }
        },
        "required": ["section", "enabled", "user_confirmed"]
      }
    },
    {
      "name": "user_profile_add_nested",
      "description": "Add a key-value pair to a nested object like preferences, pet_peeves, or boundaries",
      "parameters": {
        "type": "object",
        "properties": {
          "section": {
            "type": "string",
            "enum": ["preferences", "pet_peeves", "boundaries.soft_boundaries", "boundaries.sensitive_topics", "private_self.shame_triggers", "values_beliefs.political_detail.hot_topics", "custom_fields.fields"],
            "description": "Which nested section to add to"
          },
          "domain": {
            "type": "string",
            "description": "The domain/category key (e.g., 'code', 'formatting', 'family')"
          },
          "key": {
            "type": "string",
            "description": "The specific key within the domain"
          },
          "value": {
            "type": "string",
            "description": "The value/preference/note"
          }
        },
        "required": ["section", "domain", "key", "value"]
      }
    },
    {
      "name": "user_profile_query",
      "description": "Ask a specific question about the user profile. Returns relevant information without loading full sections.",
      "parameters": {
        "type": "object",
        "properties": {
          "query": {
            "type": "string",
            "description": "Natural language question about the user. E.g., 'Does the user prefer detailed explanations?', 'What are their hard boundaries?', 'What coding languages do they use?'"
          }
        },
        "required": ["query"]
      }
    },
    {
      "name": "user_profile_export",
      "description": "Export user profile data. Respects visibility tiers.",
      "parameters": {
        "type": "object",
        "properties": {
          "format": {
            "type": "string",
            "enum": ["json", "yaml", "summary"],
            "description": "Export format",
            "default": "json"
          },
          "tier": {
            "type": "string",
            "enum": ["public", "exportable", "full"],
            "description": "Which visibility tier to export. 'full' requires explicit user confirmation.",
            "default": "exportable"
          },
          "user_confirmed": {
            "type": "boolean",
            "description": "User confirmed export. Required for 'full' tier."
          }
        },
        "required": ["format"]
      }
    },
    {
      "name": "user_profile_reset",
      "description": "Reset profile sections to defaults. Destructive action requiring confirmation.",
      "parameters": {
        "type": "object",
        "properties": {
          "sections": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Sections to reset. Use ['all'] for complete reset."
          },
          "preserve_identity": {
            "type": "boolean",
            "description": "Keep identity section intact even on full reset",
            "default": true
          },
          "user_confirmed": {
            "type": "boolean",
            "description": "User explicitly confirmed reset. Must be true."
          },
          "confirmation_phrase": {
            "type": "string",
            "description": "User's confirmation phrase for audit log"
          }
        },
        "required": ["sections", "user_confirmed", "confirmation_phrase"]
      }
    }
  ],

  "tool_usage_guidelines": {
    "on_conversation_start": [
      "Always call user_profile_read with sections relevant to likely conversation topics",
      "At minimum, read: identity, communication, persona_preferences, interaction, relationship_metrics",
      "Read additional sections based on conversation context"
    ],
    "during_conversation": [
      "Log positive events promptly - don't wait for session end",
      "Log negative events immediately for accurate tracking",
      "Update preferences/pet_peeves when user explicitly states them",
      "Never update private_self, sexual_romantic, or substances_health without explicit user initiation"
    ],
    "on_conversation_end": [
      "Log session_end event",
      "Ensure all notable events are logged",
      "Update interaction_count via increment operation"
    ],
    "sensitive_sections": {
      "sexual_romantic": "Only read/write when user explicitly enables or discusses",
      "substances_health": "Only access when user initiates health/substance discussion",
      "private_self": "Never surface this information. Use only for avoidance/context",
      "financial_context": "Only when user explicitly discusses finances"
    }
  }
}
