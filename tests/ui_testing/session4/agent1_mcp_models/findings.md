# MCP Servers & Model Switching - UI Test Findings

**Date:** 2026-01-25T20:40:57.358Z
**User:** testuser_mcp1_1769373644588
**URL:** http://localhost:8080

---

## Test Results

### Setup

- Registration: 200
- Login: 200
- Authenticated as: testuser_mcp1_1769373644588

### E. Model Switching

- Current model: qwen2.5-coder:3b
- Total models: 5
- Adult mode: false
-   - qwen2.5-coder:3b [tools]
-   - gurubot/self-after-dark:latest [tools]
-   - ministral-3:latest [tools]
-   - qwen3-vl:8b [tools]
-   - deepseek-coder-v2:latest [basic]

### A. MCP Section

- Settings click: success
- MCP in page: true
- MCP servers container found

### B. Add MCP Server

- Add button: 
                        add_circle
                        Add MCP Server
                    
- Form fields: name=true, command=true, args=true

### C. Server List

- Servers: 0

### D. Connection Status

- Connected indicators: 2
- Disconnected indicators: 0
- Toggle buttons: 0

### F. Capability Updates

- Model: qwen2.5-coder:3b
- Capabilities: completion, tools, insert
- Vision: false
- Tools: true
- Thinking: false
- Available tools (4):
-   - web_search: Web Search
-   - browse_website: Browse Website
-   - search_conversations: Search Conversations
-   - search_knowledge_base: Knowledge Base

### G. Rapid Model Switching

- Testing 4 models
- qwen2.5-coder:3b: 10ms
- gurubot/self-after-dark:latest: 8ms
- ministral-3:latest: 8ms
- qwen3-vl:8b: 8ms
- Final: qwen3-vl:8b (vision=true, tools=true)

### Complete

- All tests completed successfully

---

## Screenshots

- `00_initial_load.png`
- `01_after_auth.png`
- `02_main_view.png`
- `03_models_api.png`
- `04_after_settings_click.png`
- `06_mcp_servers.png`
- `07_add_server_modal.png`
- `08_server_list.png`
- `09_connection_status.png`
- `10_capabilities.png`
- `11_switch_1_qwen2.5-coder_3b.png`
- `11_switch_2_gurubot_self-after-dark_l.png`
- `11_switch_3_ministral-3_latest.png`
- `11_switch_4_qwen3-vl_8b.png`
- `20_final_state.png`

---

## Source Code Analysis

### MCP System (mcp.js)
- **MCPManager class** - manages server lifecycle
- **Transport:** stdio (subprocess-based)
- **UI Elements:**
  - `#mcp-servers` - server list container
  - `#mcp-add-modal` - add server form
  - Form fields: name, command, args
- **Status Indicators:**
  - Green dot (`.bg-green-500`) = connected
  - Gray dot (`.bg-gray-500`) = disconnected
- **Toggle Buttons:** `.mcp-toggle-btn` (play/stop icons)

### MCP API (mcp.py)
- `GET /api/mcp/servers` - list user's MCP servers
- `POST /api/mcp/servers` - add new server
- `DELETE /api/mcp/servers/{id}` - remove server
- `POST /api/mcp/servers/{id}/connect` - connect to server
- `POST /api/mcp/servers/{id}/disconnect` - disconnect
- `GET /api/mcp/tools` - list tools from connected servers
- **Security:** command allowlist, argument validation

### Models API (models.py)
- `GET /api/models` - list models with capabilities
- `POST /api/models/select` - switch active model
- `GET /api/models/current` - get current model
- `GET /api/models/capabilities` - get model capabilities
- **Capabilities:** vision, tools, thinking
- **Filtering:** adult mode hides uncensored models

---

## Key Observations

1. **MCP Architecture**
   - Stdio-based transport (subprocess)
   - Command validation for security
   - Server persistence in SQLite

2. **Model System**
   - Fast model switching (<100ms via API)
   - Dynamic capability detection
   - Tool availability per model

3. **Auth System**
   - HTTP-only cookies for session
   - Session marker in sessionStorage
   - New tab detection requires re-auth

---

*Generated by UI Testing Agent 1*
